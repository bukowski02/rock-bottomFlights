<!DOCTYPE html>
<html lang="en-US">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
        <link rel="stylesheet" href="styles.css">

        <!-- add an icon for the site maybe -->
        <link rel="icon" type="image/x-icon" href="icon.ico">

        <!-- import valid form options -->
        <script src="data.js"></script>

        <title>Rock-bottom Flights</title>
    </head>
    <body>
        <div class="container-fluid">

            <!-- header -->
            <div class="row" id="headerDiv">
                <div class="col-3 .d-none .d-md-block"></div>
                <div class="col-md-6 container-fluid">
                    <div class="row">
                        <div class="col-2 d-flex justify-content-center"><!-- logo -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="my-auto bi bi-geo-fill" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999zm2.493 8.574a.5.5 0 0 1-.411.575c-.712.118-1.28.295-1.655.493a1.319 1.319 0 0 0-.37.265.301.301 0 0 0-.057.09V14l.002.008a.147.147 0 0 0 .016.033.617.617 0 0 0 .145.15c.165.13.435.27.813.395.751.25 1.82.414 3.024.414s2.273-.163 3.024-.414c.378-.126.648-.265.813-.395a.619.619 0 0 0 .146-.15.148.148 0 0 0 .015-.033L12 14v-.004a.301.301 0 0 0-.057-.09 1.318 1.318 0 0 0-.37-.264c-.376-.198-.943-.375-1.655-.493a.5.5 0 1 1 .164-.986c.77.127 1.452.328 1.957.594C12.5 13 13 13.4 13 14c0 .426-.26.752-.544.977-.29.228-.68.413-1.116.558-.878.293-2.059.465-3.34.465-1.281 0-2.462-.172-3.34-.465-.436-.145-.826-.33-1.116-.558C3.26 14.752 3 14.426 3 14c0-.599.5-1 .961-1.243.505-.266 1.187-.467 1.957-.594a.5.5 0 0 1 .575.411z"/>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="my-auto bi bi-tags" viewBox="0 0 16 16">
                                <path d="M3 2v4.586l7 7L14.586 9l-7-7H3zM2 2a1 1 0 0 1 1-1h4.586a1 1 0 0 1 .707.293l7 7a1 1 0 0 1 0 1.414l-4.586 4.586a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 2 6.586V2z"/>
                                <path d="M5.5 5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm0 1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM1 7.086a1 1 0 0 0 .293.707L8.75 15.25l-.043.043a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 0 7.586V3a1 1 0 0 1 1-1v5.086z"/>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="my-auto bi bi-cloud" viewBox="0 0 16 16">
                                <path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"/>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="my-auto bi bi-geo" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6zM4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999zm2.493 8.574a.5.5 0 0 1-.411.575c-.712.118-1.28.295-1.655.493a1.319 1.319 0 0 0-.37.265.301.301 0 0 0-.057.09V14l.002.008a.147.147 0 0 0 .016.033.617.617 0 0 0 .145.15c.165.13.435.27.813.395.751.25 1.82.414 3.024.414s2.273-.163 3.024-.414c.378-.126.648-.265.813-.395a.619.619 0 0 0 .146-.15.148.148 0 0 0 .015-.033L12 14v-.004a.301.301 0 0 0-.057-.09 1.318 1.318 0 0 0-.37-.264c-.376-.198-.943-.375-1.655-.493a.5.5 0 1 1 .164-.986c.77.127 1.452.328 1.957.594C12.5 13 13 13.4 13 14c0 .426-.26.752-.544.977-.29.228-.68.413-1.116.558-.878.293-2.059.465-3.34.465-1.281 0-2.462-.172-3.34-.465-.436-.145-.826-.33-1.116-.558C3.26 14.752 3 14.426 3 14c0-.599.5-1 .961-1.243.505-.266 1.187-.467 1.957-.594a.5.5 0 0 1 .575.411z"/>
                            </svg>
                        </div>
                        <div class="col-8 container"><!-- title and subtitle -->
                            <div class="row d-flex justify-content-center">
                                <h1 class="my-auto" id="title">Rock-bottom Flights</h1>
                            </div>
                            <div id="subtitle" class="row d-flex justify-content-center">
                                <em class="my-auto">The best flights for cheap!</em>
                            </div>
                        </div>
                        <div class="col-2"></div><!-- whitespace -->
                    </div>
                </div>
                <div class="col-3 .d-none .d-md-block"></div>
            </div>

            <!-- form -->
            <div class="row" id="formDiv">
                <div class="col-2 .d-none .d-md-block"></div>
                <div class="col-md-8">
                    <form>
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="origin" placeholder="Origin Airport" aria-label="Origin" aria-describedby="submit">
                            <input type="text" class="form-control" id="destination" placeholder="Destination Airport" aria-label="Destination" aria-describedby="submit">
                        </div>
                        <div class="input-group mb-3">
                            <input type="date" class="form-control" id="departureDate" name="departureDate" placeholder="Departure Date (YYYY-MM-DD)" aria-label="Departure Date" aria-describedby="submit">
                            <input type="date" class="form-control" id="returnDate" name="returnDate" placeholder="Return Date (optional)" aria-label="Return Date" aria-describedby="submit">
                            <input type="text" list="currencies" class="form-control" id="currency" name="currency" placeholder="Currency (start typing)" aria-label="Currency" aria-describedby="submit">
                            <button id="submit" class="btn btn-outline-primary" type="button">Search</button>
                        </div>


                        <datalist id="currencies"></datalist>
                    </form>
                </div>
                <div class="col-2 .d-none .d-md-block"></div>
            </div>

            <!-- table -->
            <div class="row">
                <div class="col-2 .d-none .d-md-block"></div>
                <div class="col-md-8">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">sample</th>
                                <th scope="col">table</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>yes</td>
                                <td>no</td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>0</td>
                            </tr>
                            <tr>
                                <td>A</td>
                                <td>B</td>
                            </tr>
                            <tr>
                                <td>test</td>
                                <td>test</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-2 .d-none .d-md-block"></div>
            </div>

            <div class="row" id="api-dump"></div><br>
            <div class="row" id="hahaha"></div>
        </div>

        <!-- bottom script -->
        <script>
            const api_key = "dfdad83bd9msh0be17af8e1d9199p128df6jsn12ce43dd715a";

            /* handles request */
            function api(query){
                return fetch(query, {
                    "method": "GET",
                    "headers": {
                        "x-rapidapi-key": api_key,
                        "x-rapidapi-host": "skyscanner-skyscanner-flight-search-v1.p.rapidapi.com"
                    }
                })
                .then(response => {
                    //console.log(response.json());
                    return response.json();
                })
                .catch(err => {
                    console.error(err);
                });
            }

            /* form event listener */
            document.getElementById("submit").addEventListener("click", async function(e){
                e.preventDefault(); //stops button from redirecting

                //assemble api query
                var query = "https://skyscanner-skyscanner-flight-search-v1.p.rapidapi.com/apiservices/browsequotes/v1.0/US/"; //generate the necessary query from the form inputs, we can assume locale and country to be en-US and US I think
                query = query.concat(document.getElementById("currency").value, "/en-US/", document.getElementById("origin").value, "/", document.getElementById("destination").value, "/", document.getElementById("departureDate").value);
                if (document.getElementById("returnDate").value){
                    query = query.concat("?inboundpartialdate=", document.getElementById("returnDate").value);
                }
                //alert(query);
                var data = await api(query);


                //deal with output here, loop stuff into a table, 
                //add visual cues, and can be sorted by price up or down
                var bottomText = "";
                for (x in data["Quotes"]){
                    bottomText += data["Quotes"][x]["MinPrice"];
                  //data["Quotes"][x]["MinPrice"];
                }
                //bottomText += data["Quotes"][0]["MinPrice"];
                //bottomText += data["Quotes"][1]["MinPrice"];



                //{"Quotes":[{"QuoteId":1,"MinPrice":100,"Direct":false,"OutboundLeg":{"CarrierIds":[1793],"OriginId":58436,"DestinationId":73076,"DepartureDate":"2021-04-04T00:00:00"},"QuoteDateTime":"2021-03-19T23:32:00"},{"QuoteId":2,"MinPrice":147,"Direct":true,"OutboundLeg":{"CarrierIds":[1793],"OriginId":58436,"DestinationId":73076,"DepartureDate":"2021-04-04T00:00:00"},"QuoteDateTime":"2021-03-19T23:32:00"}],"Carriers":[{"CarrierId":1793,"Name":"United"}],"Places":[{"Name":"Washington Dulles","Type":"Station","PlaceId":58436,"IataCode":"IAD","SkyscannerCode":"IAD","CityName":"Washington","CityId":"WASA","CountryName":"United States"},{"Name":"Chicago O'Hare International","Type":"Station","PlaceId":73076,"IataCode":"ORD","SkyscannerCode":"ORD","CityName":"Chicago","CityId":"CHIA","CountryName":"United States"}],"Currencies":[{"Code":"USD","Symbol":"$","ThousandsSeparator":",","DecimalSeparator":".","SymbolOnLeft":true,"SpaceBetweenAmountAndSymbol":false,"RoundingCoefficient":0,"DecimalDigits":2}]}
                //Quotes: [{quote1},{quote2},{quote3}]
                //Places: [{place1},{place2}]
                //Carriers: [{carrier1}]
                //Currencies: [{currency}]

                document.getElementById("hahaha").innerHTML = bottomText;

                document.getElementById("api-dump").innerHTML = JSON.stringify(data);
            });




            /* populate the form with valid options */
            //currencies
            var txt = ""
            for (x in currencyList["Currencies"]){
            txt += "<option value=\"" + currencyList["Currencies"][x]["Code"] + "\">";
            }
            document.getElementById("currencies").innerHTML = txt;
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
    </body>
</html>